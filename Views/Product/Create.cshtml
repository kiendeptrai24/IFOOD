@using iFood.Data.Enum
@using iFood.ViewModels
@model CreateProductViewModel

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        --warning-gradient: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
        --shadow-soft: 0 15px 35px rgba(0,0,0,0.1);
        --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
        --glass-bg: rgba(255,255,255,0.95);
        --glass-border: rgba(255,255,255,0.3);
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 20px 0;
    }

    /* Form Container */
    #formContainer {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        padding: 3rem;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--glass-border);
        position: relative;
        overflow: hidden;
        max-width: 1000px;
        margin: 2rem auto;
    }

    #formContainer::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border-radius: 50%;
        z-index: 0;
    }

    #formContainer > * {
        position: relative;
        z-index: 1;
    }

    /* Header */
    .form-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .form-title {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
    }

    .form-subtitle {
        color: #6c757d;
        font-size: 1.1rem;
        margin: 0;
    }

    /* Form Sections */
    .form-section {
        background: rgba(248, 249, 250, 0.8);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }

    .form-section:hover {
        background: rgba(248, 249, 250, 0.95);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #2d3436;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-title i {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 1.5rem;
    }

    /* Form Controls */
    .form-floating {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .form-floating .form-control,
    .form-floating .form-select {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 1.5rem 1.25rem 0.75rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: rgba(255,255,255,0.9);
        backdrop-filter: blur(10px);
    }

    .form-floating .form-control:focus,
    .form-floating .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.15);
        transform: translateY(-2px);
        background: #fff;
        outline: none;
    }

    .form-floating > label {
        color: #6c757d;
        font-weight: 500;
        transition: all 0.3s ease;
        padding: 1rem 1.25rem;
    }

    .form-floating .form-control:focus ~ label,
    .form-floating .form-control:not(:placeholder-shown) ~ label {
        color: #667eea;
        transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
    }

    /* Textarea Specific */
    .form-floating textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }

    /* Select Enhancement */
    .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23667eea' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
    }

    /* Image Upload Area */
    .image-upload-section {
        text-align: center;
    }

    .upload-placeholder {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border: 3px dashed rgba(102, 126, 234, 0.3);
        border-radius: 20px;
        height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .upload-placeholder:hover {
        border-color: #667eea;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
    }

    .upload-placeholder i {
        font-size: 4rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .upload-placeholder:hover i {
        transform: scale(1.1);
    }

    .upload-text {
        color: #667eea;
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }

    .upload-subtext {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .file-input {
        opacity: 0;
        position: absolute;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .image-preview {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border-radius: 17px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .image-preview.show {
        opacity: 1;
    }

    .image-preview-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        border-radius: 17px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .image-preview:hover .image-preview-overlay {
        opacity: 1;
    }

    .change-image-text {
        color: white;
        font-weight: 600;
        font-size: 1rem;
    }

    /* Submit Button */
    .btn-submit {
        background: var(--warning-gradient);
        border: none;
        border-radius: 20px;
        padding: 1rem 3rem;
        font-size: 1.2rem;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        box-shadow: 0 8px 20px rgba(247, 151, 30, 0.3);
        width: 100%;
        margin-top: 2rem;
    }

    .btn-submit:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(247, 151, 30, 0.4);
        color: white;
    }

    .btn-submit:active {
        transform: translateY(-1px);
    }

    /* Validation Styles */
    .text-danger {
        color: #dc3545;
        font-size: 0.875rem;
        font-weight: 500;
        margin-top: 0.5rem;
        display: block;
    }

    .form-control.is-invalid,
    .form-select.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.15);
    }

    .form-control.is-valid,
    .form-select.is-valid {
        border-color: #28a745;
        box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.15);
    }

    /* Progress Indicator */
    .progress-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
        gap: 1rem;
    }

    .progress-step {
        width: 40px;
        height: 4px;
        background: #e9ecef;
        border-radius: 2px;
        transition: all 0.3s ease;
    }

    .progress-step.active {
        background: var(--primary-gradient);
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        #formContainer {
            margin: 1rem;
            padding: 2rem 1.5rem;
            border-radius: 25px;
        }
        
        .form-title {
            font-size: 2rem;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-section {
            padding: 1.5rem;
        }
        
        .upload-placeholder {
            height: 250px;
        }
        
        .upload-placeholder i {
            font-size: 3rem;
        }
        
        .row {
            margin: 0;
        }
        
        .col-md-6 {
            padding: 0;
        }
    }

    /* Loading Animation */
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-section {
        animation: fadeInUp 0.6s ease forwards;
    }

    .form-section:nth-child(even) {
        animation-delay: 0.2s;
    }

    .form-section:nth-child(odd) {
        animation-delay: 0.1s;
    }

    /* Custom Scrollbar */
    textarea::-webkit-scrollbar {
        width: 8px;
    }

    textarea::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    textarea::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 10px;
    }

    /* Floating Label Fix */
    .form-floating > .form-control:focus ~ label,
    .form-floating > .form-control:not(:placeholder-shown) ~ label,
    .form-floating > .form-select ~ label {
        opacity: 0.65;
        transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
    }

    /* Enhanced hover effects */
    .form-floating:hover .form-control,
    .form-floating:hover .form-select {
        border-color: rgba(102, 126, 234, 0.5);
        transform: translateY(-1px);
    }

    /* Success state animation */
    @@keyframes successPulse {
        0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
    }

    .form-control.is-valid {
        animation: successPulse 2s infinite;
    }
</style>

<section>
    <div class="container-fluid">
        <div id="formContainer">
            <!-- Header -->
            <div class="form-header">
                <h1 class="form-title">
                    <i class="bi bi-plus-circle-fill"></i>
                    Add New Product
                </h1>
                <p class="form-subtitle">Create and manage your product inventory with ease</p>
            </div>

            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-step active"></div>
                <div class="progress-step active"></div>
                <div class="progress-step"></div>
            </div>

            <!-- Form -->
            <form method="post" asp-action="Create" enctype="multipart/form-data" id="productForm">
                <input type="hidden" id="AppUserId" name="AppUserId" asp-for="AppUserId" />
                
                <div class="row g-4">
                    <!-- Left Column - Product Information -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="bi bi-info-circle-fill"></i>
                                Product Information
                            </h3>
                            
                            <div class="form-floating">
                                <input class="form-control" 
                                       asp-for="Title" 
                                       type="text" 
                                       placeholder="Product Title" 
                                       required />
                                <label asp-for="Title">Product Title</label>
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>

                            <div class="form-floating">
                                <select asp-for="Category" 
                                        asp-items="@Html.GetEnumSelectList<ProductCategory>()" 
                                        class="form-select" 
                                        required>
                                    <option selected="selected" value="">--Select Category--</option>
                                </select>
                                <label asp-for="Category">Product Category</label>
                                <span asp-validation-for="Category" class="text-danger"></span>
                            </div>

                            <div class="form-floating">
                                <textarea class="form-control" 
                                          asp-for="Description" 
                                          placeholder="Product Description" 
                                          style="min-height: 120px;" 
                                          required></textarea>
                                <label asp-for="Description">Product Description</label>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Pricing & Image -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="bi bi-currency-dollar"></i>
                                Pricing & Stock
                            </h3>
                            
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <div class="form-floating">
                                        <input type="number" 
                                               asp-for="Quantity" 
                                               class="form-control" 
                                               placeholder="Quantity" 
                                               min="1" 
                                               required />
                                        <label asp-for="Quantity">Quantity</label>
                                        <span asp-validation-for="Quantity" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-floating">
                                        <input type="number" 
                                               asp-for="Price" 
                                               class="form-control" 
                                               placeholder="Price" 
                                               min="0.01" 
                                               step="0.01" 
                                               required />
                                        <label asp-for="Price">Price ($)</label>
                                        <span asp-validation-for="Price" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-floating">
                                <input class="form-control" 
                                       asp-for="Date" 
                                       type="date" 
                                       placeholder="Release Date" 
                                       id="dateInput" 
                                       required />
                                <label asp-for="Date">Release Date</label>
                                <span asp-validation-for="Date" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Image Upload Section -->
                        <div class="form-section image-upload-section">
                            <h3 class="section-title">
                                <i class="bi bi-image-fill"></i>
                                Product Image
                            </h3>
                            
                            <div class="upload-placeholder" id="uploadIcon">
                                <div class="image-preview" id="imagePreview">
                                    <div class="image-preview-overlay">
                                        <span class="change-image-text">
                                            <i class="bi bi-camera me-2"></i>Change Image
                                        </span>
                                    </div>
                                </div>
                                <i class="bi bi-cloud-upload" id="uploadIconElement"></i>
                                <div class="upload-text">Click to upload product image</div>
                                <div class="upload-subtext">PNG, JPG up to 10MB</div>
                                <input asp-for="Image" 
                                       type="file" 
                                       class="file-input" 
                                       id="productImage" 
                                       accept="image/*" 
                                       required />
                            </div>
                            <span asp-validation-for="Image" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-submit" id="submitBtn">
                    <i class="bi bi-plus-circle me-2"></i>
                    Create Product
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Enhanced JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const productImageInput = document.getElementById('productImage');
        const uploadIcon = document.getElementById('uploadIcon');
        const uploadIconElement = document.getElementById('uploadIconElement');
        const imagePreview = document.getElementById('imagePreview');
        const dateInput = document.getElementById('dateInput');
        const form = document.getElementById('productForm');
        const submitBtn = document.getElementById('submitBtn');

        // Set today's date as default
        const today = new Date().toISOString().split('T')[0];
        if (!dateInput.value) {
            dateInput.value = today;
        }

        // Enhanced Image Upload with Preview
        productImageInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert('Please select a valid image file.');
                    return;
                }

                // Validate file size (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('File size must be less than 10MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    // Set image as background
                    imagePreview.style.backgroundImage = `url(${e.target.result})`;
                    imagePreview.classList.add('show');
                    
                    // Hide upload icon
                    uploadIconElement.style.display = 'none';
                    document.querySelector('.upload-text').style.display = 'none';
                    document.querySelector('.upload-subtext').style.display = 'none';
                    
                    // Add success animation
                    uploadIcon.style.borderColor = '#28a745';
                    uploadIcon.style.background = 'linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%)';
                };
                reader.readAsDataURL(file);
            }
        });

        // Click to upload functionality
        uploadIcon.addEventListener('click', function() {
            productImageInput.click();
        });

        // Drag and Drop functionality
        uploadIcon.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#667eea';
            this.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%)';
        });

        uploadIcon.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = 'rgba(102, 126, 234, 0.3)';
            this.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)';
        });

        uploadIcon.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                productImageInput.files = files;
                productImageInput.dispatchEvent(new Event('change'));
            }
        });

        // Form validation enhancement
        const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        
        inputs.forEach(input => {
            input.addEventListener('blur', validateInput);
            input.addEventListener('input', validateInput);
        });

        function validateInput(e) {
            const input = e.target;
            const isValid = input.checkValidity();
            
            input.classList.remove('is-valid', 'is-invalid');
            
            if (input.value.trim() !== '') {
                if (isValid) {
                    input.classList.add('is-valid');
                } else {
                    input.classList.add('is-invalid');
                }
            }
            
            updateProgressIndicator();
        }

        // Progress indicator update
        function updateProgressIndicator() {
            const totalInputs = inputs.length;
            const validInputs = form.querySelectorAll('.is-valid').length;
            const progress = Math.round((validInputs / totalInputs) * 3);
            
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach((step, index) => {
                if (index < progress) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        // Enhanced form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate all inputs
            let isValid = true;
            inputs.forEach(input => {
                if (!input.checkValidity()) {
                    isValid = false;
                    input.classList.add('is-invalid');
                }
            });

            if (isValid) {
                // Show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="spinner-border spinner-border-sm me-2" role="status"></div>Creating Product...';
                
                // Submit after short delay for UX
                setTimeout(() => {
                    form.submit();
                }, 1000);
            } else {
                // Scroll to first invalid input
                const firstInvalid = form.querySelector('.is-invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
            }
        });

        // Real-time price formatting
        const priceInput = document.querySelector('input[asp-for="Price"]');
        if (priceInput) {
            priceInput.addEventListener('input', function() {
                let value = parseFloat(this.value);
                if (!isNaN(value)) {
                    // Update any price display if needed
                }
            });
        }

        // Auto-resize textarea
        const textarea = document.querySelector('textarea');
        if (textarea) {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.max(120, this.scrollHeight) + 'px';
            });
        }

        // Smooth animations on form focus
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.closest('.form-section').style.transform = 'translateY(-5px)';
            });
            
            input.addEventListener('blur', function() {
                this.closest('.form-section').style.transform = 'translateY(0)';
            });
        });
    });
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}